<!doctype html>
<meta charset="utf-8">
<html>
<head>
<!--<META content="text/html; charset=utf-8" http-equiv=Content-Type>
 <META name=GENERATOR content="TAGFREE Active Designer"> -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type=text/javascript>
//GLOBAL VARIABLE
var fileContent = "";
var testUrl = "http://gofficeplus.lgcns.com/MbMain.do?method=addHappy&type=H&sysTypeCd=BL&publicFg=Y&docId=76811&blogEmpNo=76705&replyOwnrId=76705&contents=test";
var strUrl = "http://gofficeplus.lgcns.com/MbMain.do?method=addHappy&type=H&sysTypeCd=BL&publicFg=Y";
var targetEmpNum = "&docId=";
var userEmpNum = "&blogEmpNo=";
var replyOwnrId = "&replyOwnrId=";
var contents = "&contents=";

var ERROR_PROGRAM_UNKNOWN = "invalid program exit status.";
var ERROR_NOT_SUPPORT_FILE_TYPE = "invalid file type.";

var workingWindow;

var arr_Number = new Array();
var arr_Name = new Array();
var arr_Contents = new Array();
/*
arrNum[0]  = "69439"; arrNm[0] = "KIWAN PARK";
arrNum[1]  = "52115"; arrNm[1] = "WOOGA XON";
arrNum[2]  = "73211"; arrNm[2] = "LIM KYU TAE";
arrNum[3]  = "71644"; arrNm[3] = "JongChun Kim";
arrNum[4]  = "72302"; arrNm[4] = "Yongha Jin";
arrNum[5]  = "75232"; arrNm[5] = "Seongyup Kim";
arrNum[6]  = "73522"; arrNm[6] = "Jiyoung Nam";
arrNum[7]  = "76980"; arrNm[7] = "TAESUNG SUK";
arrNum[8]  = "76105"; arrNm[8] = "Sang Geun Lee";
arrNum[9]  = "77338"; arrNm[9] = "SONGEE KIM";
arrNum[10] = "75451"; arrNm[10] = "Ye Jin Kim";
arrNum[11] = "75442"; arrNm[11] = "June Hyouk Kim";
arrNum[12] = "74956"; arrNm[12] = "Hakkeun Kim";
arrNum[13] = "74942"; arrNm[13] = "Joohee Moon";
arrNum[14] = "77339"; arrNm[14] = "Jinhwa Park";
arrNum[15] = "75978"; arrNm[15] = "JONGMIN BAEK";
arrNum[16] = "72918"; arrNm[16] = "Kyungtae Lee";
arrNum[17] = "78624"; arrNm[17] = "Doe Eon KIM";
arrNum[18] = "76764"; arrNm[18] = "Se Wook Kim";
arrNum[19] = "76912"; arrNm[19] = "Leekyung Kim";
arrNum[20] = "78575"; arrNm[20] = "Jingoo Kim";
arrNum[21] = "78626"; arrNm[21] = "chansik kim";
arrNum[22] = "76705"; arrNm[22] = "Hyun Ku Bae";
arrNum[23] = "76975"; arrNm[23] = "GAIM YANG";
arrNum[24] = "76847"; arrNm[24] = "Eunji Yang";
arrNum[25] = "78625"; arrNm[25] = "Yang jaeseok";
arrNum[26] = "76702"; arrNm[26] = "SEURGI IM";
arrNum[27] = "76811"; arrNm[27] = "SoonMin Jang";
arrNum[28] = "77331"; arrNm[28] = "Changwan Choi";
arrNum[29] = "77340"; arrNm[29] = "SeongHo Han";
*/

$(document).ready(function() {
	$("#version").html(Date());

	$("#saveTime").click(function() {
		if(addCommentor_init()) {
			addCommentor_start();
		} else {
			alert(ERROR_PROGRAM_UNKNOWN);
		}
	});//END OF saveTime CLICK EVENT

	var fileInput = $("#fileInput").get(0);//document.getElementById("fileInput");
	
	fileInput.addEventListener("change",
		function(e) {
			fileContent = "";
			var filee = fileInput.files[0];
			var textType = /text.*/;
			if(filee.type.match(textType)) {
				var reader = new FileReader();
				reader.onload = function(e) {
													$("#fileContent").val(reader.result);
												}
				reader.readAsText(filee, "UTF-8");//euc-kr
			} else {
				alert(ERROR_NOT_SUPPORT_FILE_TYPE);
			}//END OF IF/ELSE
		});
		//END OF EVENT LISTENER

});//END OF READY

function addCommentor_init() {
	var i = 0; var j = 0;
	
	var fileContent = $("#fileContent").val();
	if(fileContent.length == 0)
		return false;
		
	var pattern_line = /[\wㄱ-힣.,;:\'\"\[{\]}\|`~!@#$%^&*()-_=+ ]+/g;
	var pattern_innerLine = /[\wㄱ-힣.,;:\'\"\[{\]}\|`~!@#$%^&*()-_=+]+/g;
	var lines = fileContent.match(pattern_line);

	//console.log("fileContent : " +fileContent);
	for(i=0; i<lines.length; i++) {
		
		var words = lines[i].match(pattern_innerLine);
		arr_Contents[i] = "";
		
		for(j=0; j<words.length; j++) {
			//console.log(words[j]);
			if(j == 0) {
				arr_Number[i] = words[j]; 
			} else if(j == 1) {
				arr_Name[i] = words[j];
			} else {
				arr_Contents[i] += words[j] + " ";
			}
		}//END OF INNER FORLOOP
	}//END OF OUTER FORLOOP
	
	workingWindow = window.open("", "workingWindow");
	
	return true;
}

var intervalf;
var inx;

function addCommentor_start() {
	$("#chk").html("0/"+arr_Number.length);
	$("#pbar").attr("max", arr_Number.length);
	inx = 0;
	intervalf = setInterval(function(){ addCommentor_processing(); }, 2000);
}

function addCommentor_processing() {
	if(inx == arr_Number.length) {
		jangHelper_end();
		return;
	}
	$("#chk").html("" + (inx+1) + "/" + arr_Number.length);
	
	var newA = document.createElement("a");
	newA.id = arr_Number[inx];
	newA.innerHTML = arr_Number[inx] + "_" + arr_Name[inx];
	newA.href =	strUrl +
							targetEmpNum + arr_Number[inx] +
							userEmpNum + arr_Number[inx] +		//it means userEmpNumber but it doesn't work.. useless maybe(1)
							replyOwnrId + arr_Number[inx] +		//it means userEmpNumber but it doesn't work.. useless maybe(2)
							contents + arr_Contents[inx];
	newA.style.visibility = "hidden";
	newA.target = "workingWindow";
	document.body.appendChild(newA);
	document.body.appendChild(document.createElement("br"));
	
	console.log(arr_Contents[inx] + " | url : " + newA.href);
	//newA.click();
	$("#pbar").attr("value", ++inx);
}

function jangHelper_end() {
	window.clearInterval(intervalf);
	workingWindow.close();
}

</script>
</head>
<body>
	
<div id="version"></div><br><br>

	<input type="file" id="fileInput"><br><br>
	<input type="button" id="saveTime" value="saveTime" style="background:white; border:1px solid #ddd;"/>
	<progress 					 id="pbar" value="0" max="100"></progress>
	<div id="chk"></div>


<div style="visibility:hidden;">
	<textarea id="fileContent"></textarea>
</div>

</body>
</html>